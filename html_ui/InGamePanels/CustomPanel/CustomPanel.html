<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="/SCSS/common.css" />
    <link rel="stylesheet" href="CustomPanel.css" />

    <script type="text/javascript" src="/JS/coherent.js"></script>
    <script type="text/javascript" src="/JS/common.js"></script>
    <script type="text/javascript" src="/JS/dataStorage.js"></script>
    <script type="text/javascript" src="/JS/buttons.js"></script>
    <script type="text/javascript" src="/JS/Services/ToolBarPanels.js"></script>
    <script type="text/javascript" src="/Pages/VCockpit/Instruments/Shared/BaseInstrument.js"></script>

    <link rel="import" href="/templates/ingameUi/ingameUi.html" />
    <link rel="import" href="/templates/ingameUiHeader/ingameUiHeader.html" />

    <script type="text/javascript" src="/Pages/VCockpit/Instruments/OpenSquawkBridge/bridge_shared.js"></script>
    <script type="text/javascript" src="/Pages/VCockpit/Instruments/OpenSquawkBridge/OpenSquawkBridge.js"></script>
    <script type="text/javascript" src="CustomPanel.js"></script>
</head>
<body class="border-box">
    <ingamepanel-opensquawk-bridge>
        <ingame-ui id="CustomPanel" panel-id="PANEL_CUSTOM_PANEL" title="OpenSquawk Bridge" class="ingameUiFrame panelInvisible" content-fit="false" min-width="640" min-height="420">
            <div id="osb-root">
                <header id="osb-header">
                    <div class="osb-title-wrap">
                        <h1>OpenSquawk Bridge (Global Panel)</h1>
                        <p class="osb-subtitle">Aircraft-independent MSFS SimVar bridge with deep runtime tracing</p>
                    </div>
                    <div id="osb-runtime-meta">
                        <span id="osb-build-label">build: 0.3.0/custompanel</span>
                        <span id="osb-runtime-uptime">uptime: 0s</span>
                    </div>
                </header>

                <section id="osb-state-grid">
                    <div class="osb-state-card">
                        <span class="osb-label">User</span>
                        <span id="osb-state-user" class="osb-badge osb-badge-off">disconnected</span>
                        <span id="osb-state-user-name" class="osb-detail">-</span>
                    </div>
                    <div class="osb-state-card">
                        <span class="osb-label">Simulator</span>
                        <span id="osb-state-sim" class="osb-badge osb-badge-off">offline</span>
                        <span id="osb-state-flight" class="osb-detail">flight: inactive</span>
                    </div>
                    <div class="osb-state-card">
                        <span class="osb-label">Network</span>
                        <span id="osb-state-network" class="osb-badge osb-badge-off">idle</span>
                        <span id="osb-state-network-detail" class="osb-detail">no requests yet</span>
                    </div>
                    <div class="osb-state-card">
                        <span class="osb-label">Commands</span>
                        <span id="osb-state-command" class="osb-badge osb-badge-off">none</span>
                        <span id="osb-state-command-detail" class="osb-detail">0 applied / 0 failed</span>
                    </div>
                </section>

                <section class="osb-panel">
                    <h2>Token And Login</h2>
                    <div class="osb-form-grid">
                        <label>
                            <span>Token</span>
                            <input id="osb-token" type="text" readonly />
                        </label>
                        <label>
                            <span>Login URL</span>
                            <input id="osb-login-url" type="text" readonly />
                        </label>
                    </div>
                    <div class="osb-button-row">
                        <button id="osb-btn-open-login" type="button">Open Login URL</button>
                        <button id="osb-btn-copy-login" type="button">Copy Login URL</button>
                        <button id="osb-btn-new-token" type="button">Generate New Token</button>
                        <button id="osb-btn-force-login-poll" type="button">Force Login Poll</button>
                    </div>
                </section>

                <section class="osb-panel">
                    <h2>Bridge Configuration</h2>
                    <div class="osb-form-grid">
                        <label>
                            <span>Base URL</span>
                            <input id="osb-base-url" type="text" />
                        </label>
                        <label>
                            <span>Auth Token (optional)</span>
                            <input id="osb-auth-token" type="password" />
                        </label>
                        <label>
                            <span>Remote Debug Endpoint (optional)</span>
                            <input id="osb-remote-debug-url" type="text" />
                        </label>
                        <label>
                            <span>Active Interval (sec)</span>
                            <input id="osb-active-interval" type="number" min="1" step="1" />
                        </label>
                        <label>
                            <span>Idle Interval (sec)</span>
                            <input id="osb-idle-interval" type="number" min="1" step="1" />
                        </label>
                        <label>
                            <span>Login Poll (sec)</span>
                            <input id="osb-login-poll" type="number" min="1" step="1" />
                        </label>
                        <label>
                            <span>Telemetry Read Rate (Hz)</span>
                            <input id="osb-read-hz" type="number" min="1" step="1" />
                        </label>
                        <label>
                            <span>Stale Telemetry Limit (sec)</span>
                            <input id="osb-stale-seconds" type="number" min="1" step="1" />
                        </label>
                        <label>
                            <span>HTTP Timeout (ms)</span>
                            <input id="osb-timeout-ms" type="number" min="100" step="100" />
                        </label>
                        <label class="osb-checkbox">
                            <input id="osb-remote-debug-enabled" type="checkbox" />
                            <span>Enable periodic remote debug upload</span>
                        </label>
                        <label class="osb-checkbox">
                            <input id="osb-auto-open-login" type="checkbox" />
                            <span>Auto-open login URL on startup</span>
                        </label>
                        <label class="osb-checkbox">
                            <input id="osb-sim-command-enabled" type="checkbox" />
                            <span>Apply simulator commands from telemetry response</span>
                        </label>
                        <label class="osb-checkbox">
                            <input id="osb-debug-console" type="checkbox" />
                            <span>Echo debug logs to JS console</span>
                        </label>
                    </div>
                    <div class="osb-button-row">
                        <button id="osb-btn-save-config" type="button">Save Configuration</button>
                        <button id="osb-btn-force-status" type="button">Force Status Heartbeat</button>
                        <button id="osb-btn-force-telemetry" type="button">Force Telemetry Tick</button>
                        <button id="osb-btn-push-debug" type="button">Push Debug Snapshot</button>
                    </div>
                </section>

                <section class="osb-panel">
                    <h2>Counters</h2>
                    <div id="osb-counters" class="osb-counters-grid"></div>
                </section>

                <section class="osb-panel">
                    <h2>Trace Console</h2>
                    <div class="osb-button-row">
                        <button id="osb-btn-export-logs" type="button">Export Logs JSON</button>
                        <button id="osb-btn-clear-logs" type="button">Clear Console</button>
                    </div>
                    <div id="osb-log-console"></div>
                </section>
            </div>
        </ingame-ui>
    </ingamepanel-opensquawk-bridge>
</body>
</html>
